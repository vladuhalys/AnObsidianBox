Метод `catchError()` класу `Future` в Dart використовується для обробки помилок, які можуть виникнути під час виконання асинхронної операції. Він дозволяє перехоплювати й обробляти виключення, які були згенеровані всередині `Future`.

### Основна ідея методу `catchError()`

Коли асинхронна операція (представлена об'єктом `Future`) завершується помилкою, вона генерує виняток (exception). Метод `catchError()` дозволяє вам визначити функцію, яка обробить цей виняток. Цей метод працює подібно до блоку `catch` у традиційній обробці винятків у синхронному коді.

### Синтаксис методу `catchError()`

```dart
Future<T> catchError(Function onError, {bool Function(Object error)? test})
```

- **onError** — функція для обробки помилки. Вона приймає помилку, яка виникла, як аргумент і обробляє її. Функція може також повернути значення, яке стане результатом `Future`.
- **test** — необов'язкова функція, яка приймає помилку і повертає `true` або `false`. Якщо вона повертає `true`, то викликається функція `onError`. Якщо `false`, помилка передається далі і не обробляється цією функцією.

### Основні моменти

1. **Обробка помилок**: `catchError()` дозволяє перехопити й обробити помилки, що виникли під час виконання асинхронної операції.
2. **Можливість фільтрації**: Використовуючи параметр `test`, ви можете обробляти тільки певні типи помилок, ігноруючи інші.
3. **Перехоплення та продовження**: Якщо в `catchError()` оброблена помилка, результат може бути переданий далі для подальшої обробки або повернутий як новий результат.

### Простий приклад використання `catchError()`

```dart
Future<int> fetchData() async {
  await Future.delayed(Duration(seconds: 2));
  throw Exception("Помилка під час завантаження даних");
}

void main() {
  fetchData().catchError((error) {
    print("Помилка оброблена: $error");
  });
}
```

У цьому прикладі:

- Асинхронна операція `fetchData()` завершується з помилкою.
- Метод `catchError()` перехоплює цю помилку і виводить повідомлення "Помилка оброблена".

### Використання з `test` для фільтрації помилок

Якщо ви хочете обробляти лише певні типи помилок, ви можете скористатися параметром `test`. Він дозволяє перевірити, чи відповідає помилка певній умові.

#### Приклад фільтрації помилок:

```dart
Future<int> fetchData() async {
  await Future.delayed(Duration(seconds: 2));
  throw FormatException("Неправильний формат даних");
}

void main() {
  fetchData().catchError((error) {
    print("Помилка оброблена: $error");
  }, test: (error) => error is FormatException);
}
```

У цьому прикладі:

- Ми перевіряємо, чи є помилка типом `FormatException`. Якщо так, вона обробляється.
- Якщо помилка буде іншого типу, вона не буде оброблена і передається далі.

### Обробка помилок і продовження виконання

Після обробки помилки в `catchError()`, ви можете або завершити виконання програми, або продовжити обробку інших операцій.

#### Приклад продовження обробки:

```dart
Future<int> fetchData() async {
  await Future.delayed(Duration(seconds: 2));
  throw Exception("Помилка під час завантаження даних");
}

void main() {
  fetchData()
      .catchError((error) {
        print("Помилка оброблена: $error");
        return 0; // Повертаємо значення за замовчуванням
      })
      .then((value) {
        print("Отримано значення: $value");
      });
}
```

У цьому прикладі:

- Якщо виникає помилка, ми обробляємо її і повертаємо значення `0` як значення за замовчуванням.
- Потім метод `then()` отримує це значення і продовжує обробку.

### Приклад з [[async & await]] та обробкою помилок

Коли ви використовуєте `async/await`, обробка помилок може бути виконана за допомогою блоку `try-catch`. Однак метод `catchError()` також може бути корисним у поєднанні з цим синтаксисом.

```dart
Future<int> fetchData() async {
  await Future.delayed(Duration(seconds: 2));
  throw Exception("Помилка під час завантаження даних");
}

void main() async {
  try {
    await fetchData();
  } catch (error) {
    print("Помилка оброблена в try-catch: $error");
  }
}
```

Тут використовується стандартний підхід з `try-catch` для обробки помилок. Однак, у певних випадках використання `catchError()` може бути більш читабельним або підходящим для специфічних ситуацій.

### Підсумки

- **`catchError()`** дозволяє обробляти помилки, які виникають у `Future`.
- Він працює подібно до блоку `catch` у синхронному коді, перехоплюючи винятки.
- За допомогою параметра `test` можна фільтрувати помилки та обробляти тільки певні типи або умови.
- Після обробки помилки можна повернути значення для продовження обробки або завершення операції.
- Метод `catchError()` є корисним у поєднанні з іншими методами, як-от [[then()]] або [[whenComplete()]].

Метод `catchError()` робить обробку помилок у Dart більш гнучкою та дозволяє будувати складні асинхронні процеси з належним управлінням винятками.