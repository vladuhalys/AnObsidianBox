> [!info]
> **Broadcast Stream** в Dart — це тип потоку, який дозволяє багатьом слухачам підписуватися на нього одночасно. На відміну від **Single Subscription Stream**, де один слухач може отримати події лише один раз, **Broadcast Stream** дозволяє декільком слухачам отримувати події в реальному часі, коли вони надходять.

### Основні характеристики Broadcast Stream:

1. **Багаторазова підписка**:
    - Кілька слухачів можуть одночасно підписатися на один і той самий потік.
    - Кожен слухач отримує копії подій, які надходять у потік після його підписки.
    - Якщо слухач підписується на потік після того, як частина подій уже була передана, він не отримає події, які сталися раніше.
    
2. **Події передаються в реальному часі**:
    - Події надсилаються слухачам, коли вони відбуваються. Якщо слухач не підписався вчасно, він пропускає події, які були надіслані до цього.
    
3. **Механізм потокового мовлення**:
    - Подібний до трансляції сигналів, де потік передає події всім підписаним слухачам. Це схоже на поведінку, яку можна побачити в радіомовленні або мовленні на телебаченні, де всі підписники отримують сигнал одночасно.
    
4. **Широке використання**:
    - **Broadcast Stream** підходить для ситуацій, коли декілька об'єктів повинні реагувати на одну й ту ж подію або зміну стану.
    - Наприклад, це зручно для прослуховування подій користувача, оновлень статусу з сервера або системних повідомлень.

---
### Як створити Broadcast Stream

Щоб створити **Broadcast Stream**, найчастіше використовується об'єкт **StreamController** з параметром `broadcast`. Це дозволяє створювати потоки, які можна слухати декільком слухачам одночасно.

#### Приклад створення Broadcast Stream:

```dart
void main() {
  // Створюємо контролер для Broadcast Stream
  StreamController<int> controller = StreamController<int>.broadcast();

  // Перший слухач
  controller.stream.listen((data) {
    print('Слухач 1 отримав: $data');
  });

  // Другий слухач
  controller.stream.listen((data) {
    print('Слухач 2 отримав: $data');
  });

  // Додаємо події в потік
  controller.add(1);
  controller.add(2);
  controller.add(3);

  // Закриваємо потік
  controller.close();
}
```

У цьому прикладі:

- Ми створили `StreamController` з використанням методу `.broadcast()`, що перетворює потік у Broadcast Stream.
- Два слухачі одночасно підписуються на потік, і кожен отримує однакові події.

---
### Методи та події Broadcast Stream

**Broadcast Stream** підтримує ті самі основні методи, що й **Single Subscription Stream**, наприклад:

- `listen()` — підписує слухача на отримання подій із потоку.
- `onDone()` — викликається, коли потік завершився.
- `onError()` — обробляє помилки, які виникають у потоці.

Але важливо розуміти, що кожен слухач отримає лише ті події, які надійдуть після його підписки. Події, що були відправлені раніше, не можуть бути отримані новим слухачем.

#### Приклад з подіями після підписки:

```dart
void main() {
  StreamController<int> controller = StreamController<int>.broadcast();

  // Додаємо події в потік до підписки
  controller.add(1);
  controller.add(2);

  // Перший слухач підписується
  controller.stream.listen((data) {
    print('Слухач 1 отримав: $data');
  });

  // Додаємо ще події
  controller.add(3);
  controller.add(4);

  // Другий слухач підписується пізніше
  controller.stream.listen((data) {
    print('Слухач 2 отримав: $data');
  });

  // Додаємо останню подію
  controller.add(5);

  // Закриваємо потік
  controller.close();
}
```

У цьому прикладі:

- Перший слухач отримає події 3, 4 і 5, оскільки він підписався після того, як події 1 і 2 були передані.
- Другий слухач отримає лише подію 5, оскільки він підписався після подій 3 і 4.

---
### Використання StreamController з Broadcast Stream

Якщо вам потрібно більше контролю над потоком, ви можете використовувати **StreamController**. У випадку з Broadcast Stream, необхідно використовувати метод `broadcast()` при створенні контролера.

#### Приклад з використанням [[StreamController]]:

```dart
StreamController<int> controller = StreamController<int>.broadcast();

Stream<int> broadcastStream = controller.stream;
```

- Після створення Broadcast Stream через `StreamController`, ви можете додавати події в потік через метод `add()` контролера.
- Слухачі підписуються на потік через метод `listen()`.

---

> [!advantages] Переваги Broadcast Stream
> 
> 1. **Багато слухачів**: Одночасна підписка декількох слухачів — одна з головних переваг. Це особливо корисно, коли багато об'єктів повинні реагувати на ті самі події.
> 2. **Миттєве реагування**: Події передаються слухачам, коли вони відбуваються. Якщо слухач підписується пізніше, він отримує лише ті події, які ще не були передані.
> 3. **Гнучкість**: Broadcast Stream добре підходить для подій у реальному часі, наприклад, для підписки на повідомлення від серверів або відгуків користувача (натискання кнопок, рух миші тощо).


> [!limitations] Обмеження Broadcast Stream
> 
> 1. **Події не зберігаються**: Якщо слухач підписується після того, як подія була надіслана, він пропускає цю подію. Події не зберігаються в буфері для нових слухачів.
> 2. **Обробка лише нових подій**: Це важливо для сценаріїв, де кожен слухач повинен отримати всі події з моменту створення потоку. У таких випадках Broadcast Stream не підходить.

---
### Використання з асинхронними подіями

Broadcast Stream особливо корисний для обробки подій у реальному часі, таких як відстеження користувацьких взаємодій або системних подій. Наприклад, ви можете використовувати Broadcast Stream для відстеження натискань кнопок в інтерфейсі користувача, де кожен елемент повинен реагувати на натискання одночасно.

#### Приклад обробки подій у реальному часі:

```dart
import 'dart:async';

void main() {
  StreamController<String> controller = StreamController<String>.broadcast();

  controller.stream.listen((data) {
    print('Отримано подію: $data');
  });

  // Додаємо події, які надсилаються в потік
  Timer.periodic(Duration(seconds: 1), (timer) {
    controller.add('Подія: ${DateTime.now()}');
    if (timer.tick == 5) {
      controller.close(); // Закриваємо потік після 5 подій
      timer.cancel();     // Зупиняємо таймер
    }
  });
}
```

У цьому прикладі:

- Події надсилаються в потік через кожну секунду за допомогою таймера.
- Потім всі підписані слухачі отримують ці події.

---

>[!success] Підсумок
> **Broadcast Stream** є дуже корисним у випадках, коли вам потрібно мати декілька слухачів, які будуть одночасно отримувати події в реальному часі. Ось кілька ключових моментів:
>
>- Кожен слухач отримує події лише з моменту підписки.
>- Можна мати багато підписників одночасно.
>- Події не зберігаються і не можуть бути відтворені для нових слухачів.
>- Використовується у сценаріях, де важливо передавати події багатьом слухачам, наприклад, у системах сповіщень, обробці подій інтерфейсу користувача, оновленнях стану в реальному часі.

